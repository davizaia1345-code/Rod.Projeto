<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel do Barbeiro - Admin</title>
    <link rel="stylesheet" href="rod.css">
</head>
<body>
    <header>
        <h1>Agendamentos da Barbearia</h1>
        <button onclick="window.location.href='Rod.html'">Voltar ao Site</button>
    </header>

    <main>
        <table id="tabela-agendamentos" border="1">
            <thead>
                <tr>
                    <th>Cliente</th>
                    <th>Data e Hora</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="corpo-tabela">
                </tbody>
        </table>
    </main>

    <script>
        // üîí SEGURAN√áA: Verifica se quem est√° acessando √© o ADM
        const usuarioLogado = localStorage.getItem('usuarioEmail');
        const emailAdmin = 'davizaia1345@gmail.com'; 

        if (usuarioLogado !== emailAdmin) {
            alert('Acesso negado! Apenas o administrador pode ver esta p√°gina.');
            window.location.href = 'login.html'; 
        }

        async function carregarAgendamentos() {
            try {
                const resposta = await fetch('http://localhost:3001/agendamentos');
                const agendamentos = await resposta.json();

                const tabela = document.getElementById('corpo-tabela');
                tabela.innerHTML = '';

                agendamentos.forEach(agend => {
                    tabela.innerHTML += `
                        <tr>
                            <td>${agend.nome}</td>
                            <td>${agend.data} √†s ${agend.hora}</td> 
                            <td>
                                <button onclick="deletarAgendamento('${agend._id}')">Conclu√≠do/Excluir</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Erro ao carregar:', error);
            }
        }

        async function deletarAgendamento(id) {
            if(confirm('Deseja remover este agendamento?')) {
                await fetch(`http://localhost:3001/agendamentos/${id}`, { method: 'DELETE' });
                carregarAgendamentos();
            }
        }

        window.onload = carregarAgendamentos;
    </script>
</body>
</html>