<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin | RodBarber</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background-color: #000;
            background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.95)), url('fundo-hero.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            color: #fff;
            padding: 40px 20px;
        }

        .admin-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #121212;
            border-radius: 15px;
            border: 1px solid #333;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            overflow: hidden;
            position: relative;
        }

        .admin-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 4px;
            background: #e62e2e;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            border-bottom: 1px solid #222;
        }

        .admin-header h1 {
            font-size: 1.8rem;
            text-transform: uppercase;
            color: #fff;
            letter-spacing: 1px;
        }

        .admin-header h1 span { color: #e62e2e; }

        .btn-voltar {
            text-decoration: none;
            color: #ccc;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #444;
            padding: 8px 15px;
            border-radius: 5px;
            transition: 0.3s;
        }

        .btn-voltar:hover {
            background: #e62e2e;
            border-color: #e62e2e;
            color: white;
        }

        .table-responsive { overflow-x: auto; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        thead { background-color: #1f1f1f; }

        thead th {
            color: #e62e2e;
            text-align: left;
            padding: 20px;
            text-transform: uppercase;
            font-size: 0.85rem;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid #222;
            transition: background 0.2s;
        }

        tbody tr:last-child { border-bottom: none; }
        tbody tr:hover { background-color: #1a1a1a; }

        td { padding: 20px; color: #ddd; }

        .badge-hora {
            background: #222;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #444;
            font-weight: bold;
        }

        .btn-delete {
            background: transparent;
            border: 1px solid #ff4d4d;
            color: #ff4d4d;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.85rem;
        }

        .btn-delete:hover {
            background: #ff4d4d;
            color: white;
        }

        #mensagem-status {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div class="admin-container">
        <div class="admin-header">
            <h1>Agenda do <span>Rod</span></h1>
            <a href="Rod.html" class="btn-voltar">
                <i class="fas fa-arrow-left"></i> Voltar ao Site
            </a>
        </div>

        <div class="table-responsive">
            <table id="tabela-agendamentos">
                <thead>
                    <tr>
                        <th><i class="fas fa-user"></i> Cliente</th>
                        <th><i class="fas fa-cut"></i> Serviço</th>
                        <th><i class="fas fa-envelope"></i> E-mail</th>
                        <th><i class="fas fa-calendar-alt"></i> Data</th>
                        <th><i class="fas fa-clock"></i> Horário</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="lista-corpo"></tbody>
            </table>
            <p id="mensagem-status">Carregando agendamentos...</p>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001';
        const listaCorpo = document.getElementById('lista-corpo');
        const statusMsg = document.getElementById('mensagem-status');

        function formatarData(dataISO) {
            if(!dataISO) return "--/--/----";
            const partes = dataISO.split('-');
            return `${partes[2]}/${partes[1]}/${partes[0]}`;
        }

        async function carregarAgendamentos() {
            try {
                const response = await fetch(`${API_URL}/agendamentos`);
                const agendamentos = await response.json();

                listaCorpo.innerHTML = '';

                if (agendamentos.length === 0) {
                    statusMsg.innerText = "Nenhum agendamento encontrado.";
                    statusMsg.style.display = 'block';
                    return;
                }

                statusMsg.style.display = 'none';
                agendamentos.reverse(); 

                agendamentos.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="font-weight: bold; color: #fff;">${item.nome}</td>
                        <td style="color: #bbb;">${item.servico || '-'}</td>
                        <td>${item.email}</td>
                        <td>${formatarData(item.data)}</td>
                        <td><span class="badge-hora">${item.hora}</span></td>
                        <td>
                            <button class="btn-delete" onclick="excluirAgendamento('${item._id}')">
                                <i class="fas fa-trash"></i> Cancelar
                            </button>
                        </td>
                    `;
                    listaCorpo.appendChild(tr);
                });

            } catch (error) {
                console.error(error);
                statusMsg.innerText = "Erro ao carregar a agenda. Verifique o servidor.";
                statusMsg.style.color = "#ff4d4d";
            }
        }

        async function excluirAgendamento(id) {
            if (confirm("Tem certeza que deseja cancelar este agendamento?")) {
                try {
                    const response = await fetch(`${API_URL}/agendamentos/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        carregarAgendamentos();
                    } else {
                        alert("Erro ao excluir.");
                    }
                } catch (error) {
                    alert("Erro de conexão.");
                }
            }
        }

        window.onload = carregarAgendamentos;
    </script>

</body>
</html>