<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia do Rod</title>
    <link rel="stylesheet" href="rod.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/png" href="https://i.ibb.co/8DXKQy0T/IMG-5529.png">
    <style>
        /* ESTILOS EXTRAS PARA OS BOT√ïES DE PAGAMENTO */
        .btn-choice-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .btn-pay-now {
            background-color: #25d366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        .btn-pay-now:hover { background-color: #1ebc57; transform: scale(1.02); }

        .btn-pay-card {
            background-color: #009ee3; /* Azul Mercado Pago */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        .btn-pay-card:hover { background-color: #007eb5; transform: scale(1.02); }

        .btn-pay-later {
            background-color: transparent;
            color: #ccc;
            border: 1px solid #555;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            width: 100%;
            max-width: 300px;
            transition: 0.3s;
        }
        .btn-pay-later:hover { border-color: #fff; color: #fff; }

        .pix-code-area {
            width: 100%;
            background: #000;
            color: #0f0;
            border: 1px solid #333;
            padding: 10px;
            font-family: monospace;
            border-radius: 5px;
            resize: none;
            margin-bottom: 10px;
        }
        .btn-copy {
            background: #333; color: #fff; border: 1px solid #555;
            padding: 8px 15px; border-radius: 5px; cursor: pointer;
            font-size: 0.9em; width: 100%; transition: 0.3s;
        }
        .btn-copy:hover { border-color: #25d366; color: #25d366; }
    </style>
</head>
<body>

<div id="area-usuario" style="display: none;">
    <div id="logado" style="display: none; align-items: center;">
        <span id="boas-vindas" style="margin-right: 15px;"></span>
        <a href="admin.html" id="btn-painel-dono" class="btn-painel" style="display: none;">
            <i class="fas fa-user-cog"></i> Painel
        </a>
        <a href="meus-agendamentos.html" style="background-color: #333; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 0.9em; margin-right: 10px;">
            <i class="far fa-calendar-alt"></i> Meus Cortes
        </a>
        <button onclick="fazerLogout()" class="btn-sair">Sair</button>
    </div>
    <div id="deslogado" style="display: none;">
         <span>Ainda n√£o tem conta? </span>
         <a href="login.html" class="link-entrar">Entrar / Cadastrar</a>
    </div>
</div>

<header class="navbar">
    <div class="logo">
        <img src="https://i.ibb.co/0jFF6FcM/IMG-5529.png" alt="Logo" style="width: 70px; vertical-align: middle; filter: drop-shadow(0px 0px 2px rgba(0,0,0,0.5));">
        RODBARBER
    </div>
    
    <input type="checkbox" id="menu-toggle" class="menu-toggle">
    <label for="menu-toggle" class="menu-icon">
        <span></span><span></span><span></span>
    </label>

    <nav>
        <ul class="nav-links">
            <li><a href="#agendamento" onclick="fecharMenuMobile()">Agendamento</a></li>
            <li><a href="#sobre" onclick="fecharMenuMobile()">Sobre</a></li>
            <li><a href="#precos" onclick="fecharMenuMobile()">Pre√ßos</a></li>
            <li><a href="#depoimentos" onclick="fecharMenuMobile()">Depoimentos</a></li>
            <li><a href="#contatos" onclick="fecharMenuMobile()">Contatos</a></li>
            <li id="btn-admin" style="display: none;">
                <a href="admin.html" style="color: #d4af37; font-weight: bold;">üëë ADMIN</a>
            </li>
        </ul>
    </nav>
    
    <a href="https://api.whatsapp.com/send?phone=5511949411527" target="_blank" class="btn-book desktop-only" style="background-color: #25d366;">
        <i class="fab fa-whatsapp"></i> Fale Conosco
    </a>
</header>
<br><br><br><br>

<main class="hero">
    <div class="hero-wrapper">
        <div class="hero-content">
            <h1>Muito Al√©m de um Corte, Uma Experi√™ncia de Cuidado Masculino.</h1>
            <div class="address">
                <p>O Melhor Lugar</p>
                <p>Para Agendar seu Corte.</p>
            </div>
        </div>

        <section class="container" id="agendamento">
            <div id="aviso-bloqueio" style="text-align: center; padding: 30px; display: block;">
                <p style="margin-bottom: 20px; font-size: 1.2em;">Voc√™ precisa estar logado para agendar.</p>
                <a href="login.html" style="background-color: #e62e2e; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;">
                    Fazer Login
                </a>
            </div>

            <div id="area-formulario" style="display: none;">
                <form id="form-agendamento">
                    <input type="hidden" id="servico-selecionado">
                    <input type="hidden" id="hora-selecionada">

                    <label><i class="fas fa-user"></i> Seus Dados:</label>
                    <input type="text" id="nome" required readonly placeholder="Nome" style="cursor: not-allowed; opacity: 0.7;">
                    <input type="email" id="email" required readonly placeholder="E-mail" style="cursor: not-allowed; opacity: 0.7;">
                    
                    <label><i class="fas fa-calendar-alt"></i> Data:</label>
                    <input type="date" id="data" required onchange="carregarHorariosDisponiveis()">

                    <label><i class="fas fa-cut"></i> Escolha o Servi√ßo:</label>
                    <div class="services-grid">
                        <div class="service-card" onclick="selecionarServico('Corte Masculino', this)">
                            <div class="service-info">
                                <span class="service-name">Corte Masculino</span>
                                <span class="service-time">‚è± 40 min</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>
                        <div class="service-card" onclick="selecionarServico('Barba Completa', this)">
                            <div class="service-info">
                                <span class="service-name">Barba Completa</span>
                                <span class="service-time">‚è± 20 min</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>
                        <div class="service-card" onclick="selecionarServico('Corte + Barba', this)">
                            <div class="service-info">
                                <span class="service-name">Corte + Barba</span>
                                <span class="service-time">‚è± 1h</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>
                    </div>

                    <label><i class="fas fa-clock"></i> Hor√°rios Dispon√≠veis:</label>
                    <p id="aviso-horario" style="font-size: 12px; color: #888; margin-bottom: 5px;">Selecione uma data para ver os hor√°rios.</p>
                    <div class="time-grid" id="container-horarios"></div>
                    <button type="submit" style="margin-top: 15px;">Confirmar Agendamento</button>
                </form>
                <div id="mensagem" style="text-align: center; margin-top: 10px; font-weight: bold;"></div>
            </div>
        </section>
    </div>
</main>

<section class="about-section hidden" id="sobre">
    <div class="about-container">
        <div class="about-content">
            <h2 class="about-title">SOBRE N√ìS</h2>
            <div class="about-separator"></div>
            <p class="about-text">A trajet√≥ria de Rodney Abr√£o come√ßou em 2022, transformando-se em uma carreira de excel√™ncia em Cidade Tiradentes.</p>
        </div>
        <div class="about-image-wrapper">
            <img src="rodimagem.jpg" alt="Rodney Abr√£o" class="about-img">
        </div>
    </div>
</section>

<footer id="contatos" class="footer-premium hidden">
    <p class="copyright">¬© 2026 <strong>Barbearia do Rod</strong>.</p>
</footer>

<script>
    // URL DO SEU SERVIDOR NO RENDER
    const API_URL = 'https://rod-bar-ber.onrender.com'; 
    let intervaloVerificacao = null;

    function fecharMenuMobile() { document.getElementById('menu-toggle').checked = false; }

    const Toast = Swal.mixin({
        toast: true, position: 'top-end', showConfirmButton: false, timer: 3000,
        background: '#1e1e1e', color: '#fff'
    });

    async function carregarHorariosDisponiveis() {
        const inputData = document.getElementById('data').value;
        const container = document.getElementById('container-horarios');
        const aviso = document.getElementById('aviso-horario');
        container.innerHTML = '';
        if (!inputData) return;
        aviso.innerText = "Carregando hor√°rios...";
        try {
            const response = await fetch(`${API_URL}/agendamentos/ocupados?data=${inputData}`);
            const horariosOcupados = await response.json(); 
            aviso.style.display = 'none';
            const horarios = ["09:00", "09:40", "10:20", "11:00", "13:00", "13:40", "14:20", "15:00", "15:40", "16:20", "17:00", "17:40", "18:20", "19:00", "19:40", "20:20"];
            horarios.forEach(h => {
                if (!horariosOcupados.includes(h)) {
                    const btn = document.createElement('div');
                    btn.className = 'time-btn';
                    btn.innerText = h;
                    btn.onclick = function() { selecionarHora(h, this) };
                    container.appendChild(btn);
                }
            });
        } catch (e) { aviso.innerText = "Erro ao carregar agenda."; }
    }

    function selecionarServico(nome, el) {
        document.getElementById('servico-selecionado').value = nome;
        document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    function selecionarHora(h, el) {
        document.getElementById('hora-selecionada').value = h;
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
    }

    document.getElementById("form-agendamento").addEventListener("submit", async (e) => {
        e.preventDefault();
        const servico = document.getElementById('servico-selecionado').value;
        const hora = document.getElementById('hora-selecionada').value;
        const data = document.getElementById('data').value;
        const nome = document.getElementById('nome').value;
        const email = document.getElementById('email').value;

        let preco = servico.includes("Corte + Barba") ? 60 : (servico.includes("Barba") ? 20 : 40);

        if(!servico || !hora || !data) return Toast.fire({ icon: 'warning', title: 'Preencha tudo!' });

        const btn = e.target.querySelector("button");
        btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Aguarde...';

        try {
            const res = await fetch(`${API_URL}/agendar`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nome, email, data, hora, servico, preco })
            });
            const result = await res.json();
            if (res.ok) {
                btn.style.display = 'none';
                document.getElementById("mensagem").innerHTML = `
                    <div class="success-container">
                        <i class="fas fa-check-circle" style="color:#25d366; font-size:3rem;"></i>
                        <h3>Agendado com Sucesso!</h3>
                        <div class="btn-choice-container" id="area-escolha">
                            <button class="btn-pay-now" onclick="mostrarAreaPix('${result.idPagamento}', '${result.qrCodeBase64}', '${result.pixCopiaCola}')">Pagar com PIX</button>
                            ${result.urlPagamentoCartao ? `<a href="${result.urlPagamentoCartao}" target="_blank" class="btn-pay-card">Pagar com Cart√£o</a>` : ''}
                            <button class="btn-pay-later" onclick="finalizarAgendamento()">Pagar na Hora</button>
                        </div>
                        <div id="area-pix-oculta" style="display:none; margin-top:20px;"></div>
                    </div>`;
            }
        } catch (err) { btn.disabled = false; btn.innerText = "Tentar Novamente"; }
    });

    function mostrarAreaPix(id, img, cod) {
        document.getElementById('area-escolha').style.display = 'none';
        const area = document.getElementById('area-pix-oculta');
        area.style.display = 'block';
        area.innerHTML = `
            <p>Escaneie o QR Code:</p>
            <img src="data:image/jpeg;base64,${img}" style="width:200px; border:5px solid #fff; border-radius:10px;">
            <p>Ou copie o c√≥digo:</p>
            <textarea id="pix-code" class="pix-code-area" readonly>${cod}</textarea>
            <button class="btn-copy" onclick="copiarPix()">COPIAR C√ìDIGO</button>
            <p id="status-pix"><i class="fas fa-sync fa-spin"></i> Aguardando pagamento...</p>
        `;
        iniciarVerificacaoPagamento(id);
    }

    function iniciarVerificacaoPagamento(id) {
        intervaloVerificacao = setInterval(async () => {
            const res = await fetch(`${API_URL}/status-pagamento/${id}`);
            const data = await res.json();
            if (data.status === 'approved') {
                clearInterval(intervaloVerificacao);
                Swal.fire({ icon: 'success', title: 'Pagamento Confirmado!', background: '#1e1e1e', color: '#fff' }).then(() => window.location.reload());
            }
        }, 4000);
    }

    function copiarPix() {
        const c = document.getElementById("pix-code"); c.select(); navigator.clipboard.writeText(c.value);
        Toast.fire({ icon: 'success', title: 'C√≥digo Copiado!' });
    }

    function finalizarAgendamento() { window.location.reload(); }

    window.onload = function() {
        const nome = localStorage.getItem('usuarioNome');
        const email = localStorage.getItem('usuarioEmail');
        if (nome && email) {
            document.getElementById('area-usuario').style.display = 'block';
            document.getElementById('logado').style.display = 'flex';
            document.getElementById('boas-vindas').innerText = "Ol√°, " + nome;
            document.getElementById('aviso-bloqueio').style.display = 'none';
            document.getElementById('area-formulario').style.display = 'block';
            document.getElementById('nome').value = nome;
            document.getElementById('email').value = email;
            if (email === "rdbarbercontato@gmail.com") document.getElementById('btn-admin').style.display = 'block';
        }
    };

    function fazerLogout() { localStorage.clear(); window.location.href = 'login.html'; }
</script>
</body>
</html>