<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia do Rod</title>
    <link rel="stylesheet" href="rod.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" type="image/png" href="https://i.ibb.co/8DXKQy0T/IMG-5529.png">
    <style>
        /* ESTILOS EXTRAS PARA OS BOT√ïES DE PAGAMENTO */
        .btn-choice-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
        }

        .btn-pay-now {
            background-color: #25d366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        .btn-pay-now:hover { background-color: #1ebc57; transform: scale(1.02); }

        .btn-pay-card {
            background-color: #009ee3; /* Azul Mercado Pago */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            max-width: 300px;
            text-decoration: none; /* Importante pois √© um link <a> */
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }
        .btn-pay-card:hover { background-color: #007eb5; transform: scale(1.02); }

        .btn-pay-later {
            background-color: transparent;
            color: #ccc;
            border: 1px solid #555;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            width: 100%;
            max-width: 300px;
            transition: 0.3s;
        }
        .btn-pay-later:hover { border-color: #fff; color: #fff; }

        /* Estilos do PIX */
        .pix-code-area {
            width: 100%;
            background: #000;
            color: #0f0;
            border: 1px solid #333;
            padding: 10px;
            font-family: monospace;
            border-radius: 5px;
            resize: none;
            margin-bottom: 10px;
        }
        .btn-copy {
            background: #333; color: #fff; border: 1px solid #555;
            padding: 8px 15px; border-radius: 5px; cursor: pointer;
            font-size: 0.9em; width: 100%; transition: 0.3s;
        }
        .btn-copy:hover { border-color: #25d366; color: #25d366; }
    </style>
</head>
<body>

<div id="area-usuario" style="display: none;">
    <div id="logado" style="display: none; align-items: center;">
        <span id="boas-vindas" style="margin-right: 15px;"></span>
        <a href="admin.html" id="btn-painel-dono" class="btn-painel" style="display: none;">
            <i class="fas fa-user-cog"></i> Painel
        </a>
        <a href="meus-agendamentos.html" style="background-color: #333; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 0.9em; margin-right: 10px;">
            <i class="far fa-calendar-alt"></i> Meus Cortes
        </a>
        <button onclick="fazerLogout()" class="btn-sair">Sair</button>
    </div>
    <div id="deslogado" style="display: none;">
         <span>Ainda n√£o tem conta? </span>
         <a href="login.html" class="link-entrar">Entrar / Cadastrar</a>
    </div>
</div>

<header class="navbar">
    <div class="logo">
        <img src="https://i.ibb.co/0jFF6FcM/IMG-5529.png" alt="Logo" style="width: 70px; vertical-align: middle; filter: drop-shadow(0px 0px 2px rgba(0,0,0,0.5));">
        RODBARBER
    </div>
    
    <input type="checkbox" id="menu-toggle" class="menu-toggle">
    <label for="menu-toggle" class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
    </label>

    <nav>
        <ul class="nav-links">
            <li><a href="#agendamento" onclick="fecharMenuMobile()">Agendamento</a></li>
            <li><a href="#sobre" onclick="fecharMenuMobile()">Sobre</a></li>
            <li><a href="#precos" onclick="fecharMenuMobile()">Pre√ßos</a></li>
            <li><a href="#depoimentos" onclick="fecharMenuMobile()">Depoimentos</a></li>
            <li><a href="#contatos" onclick="fecharMenuMobile()">Contatos</a></li>
            <li id="btn-admin" style="display: none;">
                <a href="admin.html" style="color: #d4af37; font-weight: bold;">üëë ADMIN</a>
            </li>
            <li class="mobile-only" style="display: none;"> 
                <a href="https://api.whatsapp.com/send?phone=5511949411527&text=Ol%C3%A1!%20Vim%20atrav%C3%A9s%20do%20site%20e%20gostaria%20de%20entrar%20em%20contato." target="_blank" class="btn-book" style="background-color: #25d366; display: block; text-align: center;">
                    <i class="fab fa-whatsapp"></i> Fale Conosco
                </a>
            </li>
        </ul>
    </nav>
    
    <a href="https://api.whatsapp.com/send?phone=5511949411527&text=Ol%C3%A1!%20Vim%20atrav%C3%A9s%20do%20site%20e%20gostaria%20de%20entrar%20em%20contato." target="_blank" class="btn-book desktop-only" style="background-color: #25d366;">
        <i class="fab fa-whatsapp"></i> Fale Conosco
    </a>
</header>
<br><br><br><br>

<main class="hero">
    <div class="hero-wrapper">
        <div class="hero-content">
            <h1>Muito Al√©m de um Corte, Uma Experi√™ncia de Cuidado Masculino.</h1>
            <div class="address">
                <p>O Melhor Lugar</p>
                <p>Para Agendar seu Corte.</p>
            </div>
        </div>

        <section class="container" id="agendamento">
            <div id="aviso-bloqueio" style="text-align: center; padding: 30px; display: block;">
                <p style="margin-bottom: 20px; font-size: 1.2em;">Voc√™ precisa estar logado para agendar.</p>
                <a href="login.html" style="background-color: #e62e2e; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block;">
                    Fazer Login
                </a>
            </div>

            <div id="area-formulario" style="display: none;">
                <form id="form-agendamento">
                    
                    <input type="hidden" id="servico-selecionado">
                    <input type="hidden" id="hora-selecionada">

                    <label><i class="fas fa-user"></i> Seus Dados:</label>
                    <input type="text" id="nome" required readonly placeholder="Nome" style="cursor: not-allowed; opacity: 0.7;">
                    <input type="email" id="email" required readonly placeholder="E-mail" style="cursor: not-allowed; opacity: 0.7;">
                    
                    <label><i class="fas fa-calendar-alt"></i> Data:</label>
                    <input type="date" id="data" required onchange="carregarHorariosDisponiveis()">

                    <label><i class="fas fa-cut"></i> Escolha o Servi√ßo:</label>
                    <div class="services-grid">
                        
                        <div class="service-card" onclick="selecionarServico('Corte Masculino', this)">
                            <div class="service-info">
                                <span class="service-name">Corte Masculino</span>
                                <span class="service-time">‚è± 40 min</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>

                        <div class="service-card" onclick="selecionarServico('Barba Completa', this)">
                            <div class="service-info">
                                <span class="service-name">Barba Completa</span>
                                <span class="service-time">‚è± 20 min</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>

                        <div class="service-card" onclick="selecionarServico('Corte + Barba', this)">
                            <div class="service-info">
                                <span class="service-name">Corte + Barba</span>
                                <span class="service-time">‚è± 1h (60 min)</span>
                            </div>
                            <i class="fas fa-check-circle" style="display: none;"></i>
                        </div>

                    </div>

                    <label><i class="fas fa-clock"></i> Hor√°rios Dispon√≠veis:</label>
                    <p id="aviso-horario" style="font-size: 12px; color: #888; margin-bottom: 5px;">Selecione uma data para ver os hor√°rios.</p>
                    
                    <div class="time-grid" id="container-horarios"></div>
                    
                    <button type="submit" style="margin-top: 15px;">Confirmar Agendamento</button>
                </form>
                <div id="mensagem" style="text-align: center; margin-top: 10px; font-weight: bold;"></div>
            </div>
        </section>
    </div>
</main>
<br><br><br>

<section class="about-section hidden" id="sobre">
    <div class="about-container">
        <div class="about-content">
            <div class="about-header">
                <h2 class="about-title">SOBRE N√ìS</h2>
                <div class="about-separator"></div>
            </div>
            <p class="about-text">
               <i class="fas fa-quote-left about-quote-icon"></i>
               A trajet√≥ria de <strong class="highlight-red">Rodney Abr√£o</strong> no mercado come√ßou em 2022. O que iniciou como um desafio na barbearia de um grande amigo de inf√¢ncia, rapidamente se transformou em uma <strong class="highlight-white">carreira de excel√™ncia</strong>.
               <br><br>
               Hoje, Rodney n√£o √© apenas um barbeiro, mas um <strong class="highlight-white">especialista</strong> que busca constantemente a perfei√ß√£o em cada corte e detalhe.
            </p>
        </div>
        <div class="about-image-wrapper">
            <div class="image-frame">
                <img src="rodimagem.jpg.jpg" alt="Foto de Rodney Abr√£o" class="about-img">
            </div>
        </div>
    </div>
</section>

<section class="container hidden" id="precos">
    <h2>Tabela de Pre√ßos</h2>
    <div class="precos-grid">
        <div class="preco-item">
            <span class="nome-servico"><i class="fas fa-cut"></i> Corte Masculino</span> 
            <span class="preco-valor">R$ 40,00</span>
        </div>
        <div class="preco-item">
            <span class="nome-servico"><i class="fas fa-user-tie"></i> Barba Completa</span> 
            <span class="preco-valor">R$ 20,00</span>
        </div>
        <div class="preco-item">
            <span class="nome-servico"><i class="fas fa-star"></i> Corte + Barba</span> 
            <span class="preco-valor">R$ 60,00</span>
        </div>
        <div class="preco-item">
            <span class="nome-servico"><i class="fas fa-magic"></i> Sobrancelha</span> 
            <span class="preco-valor">R$ 10,00</span>
        </div>
    </div>
</section>

<section class="container hidden">
    <h2>Galeria de Estilo</h2>
    <div class="galeria-grid">
        <div class="corte-card">
            <img src="https://i.ibb.co/bRB817kj/imagemum-jpg.jpg" alt="Freestyle">
            <div class="corte-info"><h3>FREESTYLE LATERAL</h3><p>Personalidade em cada tra√ßo.</p></div>
        </div>
        <div class="corte-card">
            <img src="https://i.ibb.co/MyqdSqwf/imagemdois-jpg.jpg" alt="Arte">
            <div class="corte-info"><h3>ARTE NA NAVALHA</h3><p>Design exclusivo.</p></div>
        </div>
        <div class="corte-card">
            <img src="https://i.ibb.co/sGhJh9M/imagemtres-jpg.jpg" alt="Nudred">
            <div class="corte-info"><h3>NUDRED & FADE</h3><p>O encaixe perfeito.</p></div>
        </div>
          <div class="corte-card">
            <img src="https://i.ibb.co/p65kNzFq/Whats-App-Image-2026-01-21-at-22-53-19-1.jpg" alt="Nudred">
            <div class="corte-info"><h3>SOCIAL & FADE</h3><p>Impon√™ncia fio a fio.</p></div>
        </div>
              <div class="corte-card">
            <img src="https://i.ibb.co/zT9vRwrM/Whats-App-Image-2026-01-21-at-22-53-19.jpg" alt="Nudred">
            <div class="corte-info"><h3>MILITAR CUT KID</h3><p>degrad√™ impec√°vel.</p></div>
        </div>
    </div>
</section>

<section class="container hidden" id="depoimentos">
    <h2>O Que Dizem Nossos Clientes</h2>
    <div class="depoimentos-grid">
        <div class="depoimento-card">
            <i class="fas fa-quote-left quote-icon"></i>
            <p>"O melhor degrad√™ da regi√£o. O Rod √© fera demais! Ambiente top e atendimento de primeira."</p>
            <h4>- Davi</h4>
            <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="depoimento-card">
            <i class="fas fa-quote-left quote-icon"></i>
            <p>"Profissionalismo puro. Cheguei e fui atendido na hora com muita qualidade. Recomendo muito!"</p>
            <h4>- Marcelo</h4>
            <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="depoimento-card">
            <i class="fas fa-quote-left quote-icon"></i>
            <p>"Papo reto, atendimento excelente, o melhor da regi√£o."</p>
            <h4>- Rafael</h4>
            <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <div class="depoimento-card">
            <i class="fas fa-quote-left quote-icon"></i>
            <p>"Corto a anos com o rod, otimo profissional e boa pessoa."</p>
            <h4>- Daniel</h4>
            <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
    </div>
</section>

<div class="social-floating">
    <a href="https://www.instagram.com/souzard_barber/" target="_blank" class="btn-float instagram"><i class="fab fa-instagram"></i></a>
    <a href="https://api.whatsapp.com/send?phone=5511949411527&text=Ol%C3%A1!%20Vim%20atrav%C3%A9s%20do%20site%20e%20gostaria%20de%20entrar%20em%20contato." target="_blank" class="btn-float whatsapp"><i class="fab fa-whatsapp"></i></a>
</div>

<footer id="contatos" class="footer-premium hidden">
    <div class="footer-content">
        <i class="fas fa-map-marker-alt footer-icon"></i>
        <div class="mapa-wrapper">
             <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3656.924765627252!2d-46.40879132375631!3d-23.57114247879434!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94ce657c7293b749%3A0x8e8334887372338!2sR.%20M%C3%A1rio%20Ferraz%20de%20Souza%2C%20889%20-%20Cidade%20Tiradentes%2C%20S%C3%A3o%20Paulo%20-%20SP%2C%2008474-320!5e0!3m2!1spt-BR!2sbr!4v1706030000000!5m2!1spt-BR!2sbr" width="100%" height="200" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
        <p class="footer-text">
            Rua M√°rio Ferraz de Souza, 889, Cidade Tiradentes, SP<br>
            <span style="color: #bbb; font-size: 0.9em; margin-top: 5px; display: inline-block;">üìß rdbarbercontato@gmail.com</span>
        </p>
    </div>
    <div class="footer-separator"></div>
    <p class="copyright">¬© 2026 <strong>Barbearia do Rod</strong>.</p>
</footer>

<script>
    const API_URL = 'http://127.0.0.1:3001'; 
    let intervaloVerificacao = null;

    function fecharMenuMobile() {
        document.getElementById('menu-toggle').checked = false;
    }

    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        background: '#1e1e1e', 
        color: '#fff',         
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    });

    async function carregarHorariosDisponiveis() {
        const inputData = document.getElementById('data').value;
        const container = document.getElementById('container-horarios');
        const aviso = document.getElementById('aviso-horario');
        
        container.innerHTML = '';
        
        if (!inputData) {
            aviso.innerText = "Selecione uma data para ver os hor√°rios.";
            aviso.style.display = 'block';
            return;
        }

        aviso.innerText = "Carregando hor√°rios...";
        aviso.style.display = 'block';

        try {
            const response = await fetch(`${API_URL}/agendamentos/ocupados?data=${inputData}`);
            const horariosOcupados = await response.json(); 

            aviso.style.display = 'none';

            const inicioManha = 9 * 60;
            const fimManha = 11 * 60 + 30;
            const inicioTarde = 13 * 60;
            const fimTarde = 21 * 60 + 30;
            const intervalo = 35;

            function criarBotoes(inicio, fim) {
                for (let tempo = inicio; tempo <= fim; tempo += intervalo) {
                    const horas = Math.floor(tempo / 60);
                    const minutos = tempo % 60;
                    const horarioFormatado = `${horas.toString().padStart(2, '0')}:${minutos.toString().padStart(2, '0')}`;

                    if (horariosOcupados.includes(horarioFormatado)) continue; 

                    const btn = document.createElement('div');
                    btn.className = 'time-btn';
                    btn.innerText = horarioFormatado;
                    btn.onclick = function() { selecionarHora(horarioFormatado, this) };
                    container.appendChild(btn);
                }
            }

            criarBotoes(inicioManha, fimManha);
            criarBotoes(inicioTarde, fimTarde);

            if (container.children.length === 0) {
                aviso.innerText = "üö´ Agenda lotada para este dia!";
                aviso.style.display = 'block';
                aviso.style.color = '#e62e2e';
            }
        } catch (error) {
            console.error(error);
            aviso.innerText = "Erro ao buscar agenda.";
            aviso.style.color = 'red';
        }
    }

    function selecionarServico(nomeServico, elementoClicado) {
        document.getElementById('servico-selecionado').value = nomeServico;
        document.querySelectorAll('.service-card').forEach(card => {
            card.classList.remove('selected');
            card.querySelector('.fa-check-circle').style.display = 'none';
        });
        elementoClicado.classList.add('selected');
        elementoClicado.querySelector('.fa-check-circle').style.display = 'block';
    }

    function selecionarHora(horario, elementoClicado) {
        document.getElementById('hora-selecionada').value = horario;
        document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('selected'));
        elementoClicado.classList.add('selected');
    }

    const form = document.getElementById("form-agendamento");
    const mensagem = document.getElementById("mensagem");

    if(form) {
        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            const servico = document.getElementById('servico-selecionado').value;
            const hora = document.getElementById('hora-selecionada').value;
            const data = document.getElementById('data').value;
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            
            let preco = 0;
            if(servico.includes("Corte Masculino")) preco = 40.00;
            else if(servico.includes("Barba Completa")) preco = 20.00;
            else if(servico.includes("Corte + Barba")) preco = 60.00;
            else if(servico.includes("Sobrancelha")) preco = 10.00;

            if(!servico || !hora || !data) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Faltam dados!',
                    text: 'Preencha data, servi√ßo e hor√°rio.',
                    background: '#1e1e1e',
                    color: '#fff',
                    confirmButtonColor: '#e62e2e'
                });
                return;
            }

            const botao = form.querySelector("button");
            botao.disabled = true;
            botao.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Confirmando...'; 

            try {
                const response = await fetch(`${API_URL}/agendar`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ nome, email, data, hora, servico, preco })
                });
                const result = await response.json();
                
                if (response.ok) {
                    botao.style.display = 'none';
                    const pixCode = result.pixCopiaCola;
                    const idPagamento = result.idPagamento;
                    const imagemBase64 = result.qrCodeBase64; 
                    const textoPix = pixCode ? pixCode : "Erro ao gerar PIX. Verifique com a barbearia.";
                    
                    // --- NOVO: PEGA O LINK DO CART√ÉO ---
                    const linkCartao = result.urlPagamentoCartao;
                    let btnCartaoHTML = '';
                    if(linkCartao) {
                        btnCartaoHTML = `
                            <a href="${linkCartao}" target="_blank" class="btn-pay-card">
                                <i class="far fa-credit-card"></i> Pagar c/ Cart√£o
                            </a>
                        `;
                    }

                    mensagem.innerHTML = `
                        <div class="success-container">
                            <i class="fas fa-check-circle success-icon" style="color: #25d366; font-size: 3rem;"></i>
                            <h3 style="color: #fff; margin: 10px 0;">Agendado!</h3>
                            <p style="color: #aaa; font-size: 0.9em;">${data} √†s ${hora}</p>
                            
                            <div class="btn-choice-container" id="area-escolha">
                                <button type="button" class="btn-pay-now" onclick="mostrarAreaPix('${idPagamento}')">
                                    <i class="fa-brands fa-pix"></i> Pagar com PIX
                                </button>
                                
                                ${btnCartaoHTML}

                                <button type="button" class="btn-pay-later" onclick="finalizarAgendamento()">
                                    Pagar Depois
                                </button>
                            </div>

                            <div id="area-pix-oculta" style="display: none;" class="pix-container">
                                <div class="pix-title">
                                    <i class="fa-brands fa-pix" style="color:#32bcad;"></i> Pagamento PIX
                                </div>
                                <div id="status-pagamento-texto" style="margin-bottom:10px; color: #aaa; font-size: 0.9rem;">
                                    <i class="fas fa-spinner fa-spin"></i> Aguardando pagamento...
                                </div>

                                <div style="text-align: center; margin: 10px 0;">
                                    <img src="data:image/jpeg;base64,${imagemBase64}" 
                                         style="width: 200px; max-width: 100%; border-radius: 8px; border: 2px solid #fff;">
                                </div>

                                <p class="pix-subtitle" style="margin-top: 5px;">Ou copie o c√≥digo:</p>
                                
                                <textarea id="pix-code" class="pix-code-area" rows="3" readonly>${textoPix}</textarea>
                                
                                <button type="button" class="btn-copy" onclick="copiarPix()">
                                    <i class="fas fa-copy"></i> COPIAR C√ìDIGO
                                </button>
                                <br><br>
                                <button type="button" class="btn-pay-later" onclick="finalizarAgendamento()">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    await carregarHorariosDisponiveis();

                } else {
                    mensagem.innerText = result.mensagem;
                    mensagem.style.color = "#ff6b6b";
                    botao.disabled = false;
                    botao.innerText = "Confirmar Agendamento";
                }
            } catch (error) {
                mensagem.innerText = "Erro de conex√£o ‚ùå";
                mensagem.style.color = "#ff6b6b";
                botao.disabled = false;
                botao.innerText = "Confirmar Agendamento";
            }
        });
    }

    function mostrarAreaPix(idPagamento) {
        document.getElementById('area-escolha').style.display = 'none';
        const areaPix = document.getElementById('area-pix-oculta');
        areaPix.style.display = 'block';
        areaPix.style.animation = 'fadeIn 0.5s ease';

        if (idPagamento) {
            iniciarVerificacaoPagamento(idPagamento);
        }
    }

    function iniciarVerificacaoPagamento(id) {
        if (intervaloVerificacao) clearInterval(intervaloVerificacao);

        intervaloVerificacao = setInterval(async () => {
            try {
                const res = await fetch(`${API_URL}/status-pagamento/${id}`);
                const data = await res.json();

                if (data.status === 'approved') {
                    clearInterval(intervaloVerificacao);
                    
                    document.getElementById('area-pix-oculta').innerHTML = `
                        <div style="text-align: center; animation: fadeIn 0.5s ease;">
                            <i class="fas fa-check-circle" style="color: #25d366; font-size: 4rem; margin-bottom: 15px;"></i>
                            <h3 style="color: #fff;">Pagamento Confirmado! üéâ</h3>
                            <p style="color: #ccc;">Obrigado! Seu hor√°rio est√° garantido.</p>
                            <br>
                            <button type="button" class="btn-pay-now" onclick="window.location.reload()" style="background: #25d366; border:none; width:100%;">
                                OK, Tudo Certo
                            </button>
                        </div>
                    `;
                    
                    const Toast = Swal.mixin({
                        toast: true, position: 'top-end', showConfirmButton: false, timer: 3000,
                        background: '#25d366', color: '#fff'
                    });
                    Toast.fire({ icon: 'success', title: 'Pagamento Recebido!' });
                }
            } catch (error) {
                console.log("Erro ao verificar pagamento", error);
            }
        }, 3000);
    }

    function finalizarAgendamento() {
        if (intervaloVerificacao) clearInterval(intervaloVerificacao);
        Swal.fire({
            icon: 'success',
            title: 'Tudo Certo!',
            text: 'Te esperamos no hor√°rio marcado.',
            background: '#1e1e1e',
            color: '#fff',
            confirmButtonColor: '#25d366'
        }).then(() => {
            window.location.reload();
        });
    }

    function copiarPix() {
        const codigo = document.getElementById("pix-code");
        codigo.select();
        codigo.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(codigo.value);
        
        const btn = document.querySelector('.btn-copy');
        btn.innerHTML = '<i class="fas fa-check-double"></i> COPIADO!';
        btn.style.background = '#1e1e1e';
        btn.style.border = '1px solid #25d366';
        
        Toast.fire({
            icon: 'success',
            title: 'C√≥digo PIX copiado!'
        });
    }

    const observer = new IntersectionObserver((entries) => entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('show') }));
    document.querySelectorAll('.hidden').forEach((el) => observer.observe(el));

    window.onload = function() {
        const hoje = new Date().toISOString().split('T')[0];
        const inputData = document.getElementById('data');
        if(inputData) inputData.setAttribute('min', hoje);

        const nomeUsuario = localStorage.getItem('usuarioNome');
        const emailUsuario = localStorage.getItem('usuarioEmail');
        
        if (nomeUsuario && emailUsuario) {
            document.getElementById('area-usuario').style.display = 'block'; 
            document.getElementById('logado').style.display = 'flex';
            document.getElementById('boas-vindas').innerText = "Ol√°, " + nomeUsuario + "!";
            document.getElementById('aviso-bloqueio').style.display = 'none'; 
            document.getElementById('area-formulario').style.display = 'block';
            document.getElementById('nome').value = nomeUsuario;
            document.getElementById('email').value = emailUsuario;

            if (emailUsuario === "rdbarbercontato@gmail.com") {
                document.getElementById('btn-admin').style.display = 'block';
                document.getElementById('btn-painel-dono').style.display = 'inline-block';
            }
        } else {
            document.getElementById('area-usuario').style.display = 'none';
            document.getElementById('aviso-bloqueio').style.display = 'block'; 
            document.getElementById('area-formulario').style.display = 'none';
        }
    };

    function fazerLogout() { localStorage.clear(); window.location.href = 'login.html'; }
</script>
</body>
</html>